<!DOCTYPE html>
<html lang="he" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScanPro | Web Scanner</title>
    <style>
        :root {
            --bg: #0c1117;
            --card: #111827;
            --accent: #10b981;
            --accent-2: #22d3ee;
            --text: #e5e7eb;
            --muted: #9ca3af;
            --border: #1f2937;
            --danger: #ef4444;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #0b1220, #0f172a 40%, #0b1325);
            color: var(--text);
            font-family: 'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif;
            min-height: 100vh;
            direction: rtl;
        }

        header {
            position: sticky;
            top: 0;
            z-index: 10;
            backdrop-filter: blur(12px);
            background: rgba(12, 17, 23, 0.9);
            border-bottom: 1px solid var(--border);
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
            letter-spacing: 0.5px;
            color: var(--text);
            text-decoration: none;
        }

        .pill {
            border: 1px solid var(--border);
            background: rgba(255, 255, 255, 0.04);
            color: var(--text);
            border-radius: 999px;
            padding: 10px 16px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }

        main {
            max-width: 1200px;
            margin: 32px auto 64px;
            padding: 0 24px;
            display: grid;
            gap: 24px;
        }

        .hero {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.08), rgba(34, 211, 238, 0.06));
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 28px;
            box-shadow: 0 24px 60px rgba(0, 0, 0, 0.25);
            display: grid;
            gap: 12px;
        }

        .hero h1 {
            margin: 0;
            font-size: 28px;
        }

        .hero p {
            margin: 0;
            color: var(--muted);
            line-height: 1.6;
        }

        .chips {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .chip {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            padding: 8px 12px;
            border-radius: 12px;
            font-size: 14px;
            color: var(--muted);
        }

        .card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.22);
        }

        .two-column {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 16px;
        }

        h2 {
            margin: 0 0 12px 0;
            font-size: 22px;
        }

        .muted {
            color: var(--muted);
        }

        form {
            display: grid;
            gap: 12px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            color: var(--muted);
            font-size: 14px;
        }

        input[type="text"],
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border-radius: 12px;
            border: 1px solid var(--border);
            background: rgba(255, 255, 255, 0.02);
            color: var(--text);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .options {
            display: grid;
            gap: 8px;
        }

        .option-row {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--muted);
            font-size: 14px;
        }

        .btn {
            border: none;
            padding: 12px 16px;
            border-radius: 12px;
            color: #0b1220;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 12px 30px rgba(16, 185, 129, 0.25);
            transition: transform 0.1s ease, box-shadow 0.2s ease;
        }

        .btn.primary {
            background: linear-gradient(135deg, #10b981, #22d3ee);
        }

        .btn.secondary {
            background: rgba(255, 255, 255, 0.06);
            color: var(--text);
            box-shadow: none;
        }

        .btn:active {
            transform: translateY(1px);
        }

        .report-grid {
            display: grid;
            gap: 10px;
        }

        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
        }

        .summary-box {
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 12px;
        }

        .summary-box strong {
            display: block;
            color: var(--text);
            margin-bottom: 6px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .table th,
        .table td {
            padding: 12px;
            text-align: right;
            border-bottom: 1px solid var(--border);
        }

        .table th {
            color: var(--muted);
            font-weight: 600;
            background: rgba(255, 255, 255, 0.02);
        }

        .status {
            padding: 6px 10px;
            border-radius: 999px;
            font-weight: 600;
            font-size: 12px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .status.open {
            background: rgba(16, 185, 129, 0.15);
            color: #34d399;
        }

        .status.filtered {
            background: rgba(234, 179, 8, 0.15);
            color: #facc15;
        }

        .status.closed {
            background: rgba(239, 68, 68, 0.15);
            color: #f87171;
        }

        .history-list {
            display: grid;
            gap: 12px;
        }

        .history-card {
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 14px;
            background: rgba(255, 255, 255, 0.02);
            display: grid;
            gap: 8px;
        }

        .history-meta {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .history-meta span {
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 6px 10px;
            font-size: 13px;
            color: var(--muted);
        }

        .history-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        footer {
            text-align: center;
            padding: 28px 0 36px;
            color: var(--muted);
            border-top: 1px solid var(--border);
            background: rgba(12, 17, 23, 0.8);
        }

        .quick-actions {
            background: rgba(255, 255, 255, 0.02);
            border: 1px dashed var(--border);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 6px;
        }

        .quick-actions strong {
            display: block;
            margin-bottom: 8px;
        }

        .action-chip {
            cursor: pointer;
            border: none;
            background: rgba(34, 211, 238, 0.1);
            border: 1px solid var(--border);
            color: var(--text);
            border-radius: 10px;
            padding: 10px 12px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }

        .action-chip:hover {
            background: rgba(16, 185, 129, 0.12);
        }

        .progress {
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.03);
            display: grid;
            gap: 8px;
        }

        .progress-bar {
            height: 8px;
            background: linear-gradient(135deg, #10b981, #22d3ee);
            border-radius: 999px;
            width: 0%;
            transition: width 0.2s ease;
        }

        .status-filters {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
            margin-bottom: 8px;
        }

        .status-filters button {
            border: 1px solid var(--border);
            background: rgba(255, 255, 255, 0.04);
            color: var(--text);
            padding: 8px 10px;
            border-radius: 10px;
            cursor: pointer;
        }

        .status-filters button.active {
            background: rgba(16, 185, 129, 0.15);
            border-color: #22d3ee;
            color: #34d399;
        }

        .logs {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 12px;
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
            font-size: 13px;
            white-space: pre-line;
            color: #cbd5f5;
        }

        @media (max-width: 600px) {
            nav {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }

            .report-header {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>

<body>
    <header>
        <nav>
            <a class="logo" href="#">
                <span style="font-size: 22px;">ğŸ›°ï¸</span>
                <span>ScanPro Web Console</span>
            </a>
            <div class="pill">Live scanning, reports & downloads</div>
        </nav>
    </header>

    <main>
        <section class="hero">
            <h1>×”×¨×¦×ª ×¡×¨×™×§×•×ª ×›××• ×‘××¤×œ×™×§×¦×™×” â€“ ×¢×›×©×™×• ×‘×“×¤×“×¤×Ÿ</h1>
            <p>
                ×”×’×“×™×¨×• ××˜×¨×•×ª, ×‘×—×¨×• ×¡×•×’×™ ×¡×¨×™×§×”, ×”×¨×™×¦×• ×‘×“×™×§×•×ª ×¢×•××§ ×•×”×•×¨×™×“×• ×“×•×—×•×ª ××¤×•×¨×˜×™×. ×”×›×œ×™ ×‘××ª×¨ × ×‘× ×” ×›×“×™ ×œ×”×¨×’×™×© ×›××•
                ScanPro ×”××§×•×¨×™×ª ×•×œ×”×¦×™×’ ×ª×•×¦××•×ª ×‘×¦×•×¨×” ×‘×¨×•×¨×”, ×¢× ××¤×©×¨×•×ª ×©×™×ª×•×£ ×•×”×•×¨×“×ª ×§×‘×¦×™×.
            </p>
            <div class="chips">
                <div class="chip">ğŸ¯ ×‘×—×™×¨×ª ×™×¢×“ ×•×¤×•×¨×˜</div>
                <div class="chip">ğŸ•µï¸ ×–×™×”×•×™ ×©×™×¨×•×ª×™× ×•××¢×¨×›×•×ª</div>
                <div class="chip">ğŸ“‘ ×“×•×—×•×ª ××•×›× ×™× ×œ×”×•×¨×“×”</div>
                <div class="chip">ğŸŒ HTTP & NSE ready</div>
            </div>
        </section>

        <section class="card">
            <div class="two-column" style="align-items: start;">
                <div>
                    <h2>×”×’×“×¨×ª ×¡×¨×™×§×”</h2>
                    <p class="muted">×‘×—×¨×• ×‘×“×™×•×§ ××ª ××•×ª× ×¤×¨×•×¤×™×œ×™× ×•×–×™×”×•×™×™× ×©×§×™×™××™× ×‘××¤×œ×™×§×¦×™×”, ×›×•×œ×œ HTTP ×•-NSE.</p>
                    <div class="quick-actions">
                        <strong>×”×¤×¢×œ×•×ª ××•×›× ×•×ª</strong>
                        <div class="chips">
                            <button type="button" class="action-chip" data-template="fast">âš¡ ×¡×¨×™×§×” ××”×™×¨×”</button>
                            <button type="button" class="action-chip" data-template="web">ğŸŒ ×‘×“×™×§×ª Web ××œ××”</button>
                            <button type="button" class="action-chip" data-template="internal">ğŸ›°ï¸ ×¡×¨×™×§×” ×¤× ×™××™×ª ×¢× NSE</button>
                        </div>
                    </div>
                    <form id="scanForm">
                        <div>
                            <label for="target">××˜×¨×” (IP / Hostname)</label>
                            <input type="text" id="target" name="target" placeholder="10.10.10.5 ××• example.com" required>
                        </div>
                        <div>
                            <label for="ports">×˜×•×•×—×™ ×¤×•×¨×˜×™×</label>
                            <input type="text" id="ports" name="ports" placeholder="1-1024, 443, 8080" value="1-1024">
                        </div>
                        <div>
                            <label for="profile">×¤×¨×•×¤×™×œ ×¡×¨×™×§×”</label>
                            <select id="profile" name="profile">
                                <option value="TCP Connect">TCP Connect</option>
                                <option value="SYN Stealth">SYN Stealth</option>
                                <option value="UDP Discovery">UDP Discovery</option>
                                <option value="Intense">Intense (Service + OS)</option>
                                <option value="Quick">Quick sweep</option>
                            </select>
                        </div>
                        <div class="options">
                            <div class="option-row">
                                <input type="checkbox" id="serviceDetection" checked>
                                <label for="serviceDetection">Service detection</label>
                            </div>
                            <div class="option-row">
                                <input type="checkbox" id="osDetection" checked>
                                <label for="osDetection">OS detection</label>
                            </div>
                            <div class="option-row">
                                <input type="checkbox" id="httpInfo" checked>
                                <label for="httpInfo">HTTP info gathering</label>
                            </div>
                            <div>
                                <label for="nseCategory">NSE category</label>
                                <select id="nseCategory">
                                    <option value="default">default</option>
                                    <option value="vuln">vuln</option>
                                    <option value="safe">safe</option>
                                    <option value="discovery">discovery</option>
                                    <option value="malware">malware</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="output">×¤×•×¨××˜ ×“×•×—</label>
                            <select id="output">
                                <option value="txt">TXT</option>
                                <option value="json">JSON</option>
                                <option value="html">HTML</option>
                            </select>
                        </div>
                        <div>
                            <label for="notes">×”×¢×¨×•×ª / ××™×§×•×“ ×¢×¡×§×™</label>
                            <textarea id="notes" placeholder="×“×’×©×™× ××™×•×—×“×™×, ×©×™××•×© ×œ×§×•×—, ××• ××” ×œ×‘×“×•×§ ×©×•×‘"></textarea>
                        </div>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button type="submit" class="btn primary">ğŸš€ ×”×¨×¦×ª ×¡×¨×™×§×”</button>
                            <button type="button" id="resetForm" class="btn secondary">× ×™×§×•×™ ×©×“×•×ª</button>
                        </div>
                    </form>
                </div>
                <div>
                    <div class="report-header">
                        <div>
                            <h2>×ª×•×¦××•×ª ×—×™×•×ª ×•×“×•×—×•×ª</h2>
                            <p class="muted">×ª×¦×•×’×” ××”×™×¨×” ×©×œ ×›×œ ××” ×©×”×¡×¨×™×§×” ××¦××”, ×¢× ××¤×©×¨×•×ª ×”×•×¨×“×”.</p>
                        </div>
                        <button id="downloadReport" class="btn secondary" disabled>â¬‡ï¸ ×”×•×¨×“ ×“×•×— × ×•×›×—×™</button>
                    </div>
                    <div id="progressBlock" class="progress" style="display: none;">
                        <div style="display:flex; justify-content: space-between; align-items: center;">
                            <strong>×”×ª×§×“××•×ª ×¡×¨×™×§×”</strong>
                            <span id="progressLabel" class="muted">×××ª×™×Ÿ ×œ×”×¨×¦×”...</span>
                        </div>
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                    <div class="report-grid" id="reportViewer">
                        <p class="muted">×¢×•×“ ×œ× × ×‘×—×¨×” ×¡×¨×™×§×” ×œ×”×¦×’×”. ×”×¨×™×¦×• ××• ×‘×—×¨×• ××—×ª ××”×™×¡×˜×•×¨×™×™×ª ×”×“×•×—×•×ª.</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="card">
            <div class="report-header">
                <div>
                    <h2>×“×•×—×•×ª ×œ×”×¦×™×’ ×•×œ×”×•×¨×™×“</h2>
                    <p class="muted">×›×œ ×”×¡×¨×™×§×•×ª ×”××—×¨×•× ×•×ª ×¢× ×›×¤×ª×•×¨ ×¦×¤×™×™×” ×•×”×•×¨×“×” ××™×™×“×™×ª.</p>
                </div>
            </div>
            <div class="history-list" id="history"></div>
        </section>
    </main>

    <footer>
        Â© 2024 ScanPro Â· ×¡×¨×™×§×•×ª, ×“×•×—×•×ª, ×•×”×•×¨×“×” ×‘××§×•× ××—×“. Â· <a href="https://github.com/ScanPro" style="color: #22d3ee;">×§×™×©×•×¨ ×œ×××’×¨</a> Â· ×§×¨×“×™×˜: ×¦×•×•×ª ScanPro ×•×”×§×”×™×œ×”.
    </footer>

    <script>
        const historyList = document.getElementById('history');
        const reportViewer = document.getElementById('reportViewer');
        const downloadButton = document.getElementById('downloadReport');
        const progressBlock = document.getElementById('progressBlock');
        const progressBar = document.getElementById('progressBar');
        const progressLabel = document.getElementById('progressLabel');

        const seedReports = [
            {
                id: 'example-intense',
                target: '10.10.10.5',
                ports: '1-1024',
                profile: 'Intense (Service + OS)',
                serviceDetection: true,
                osDetection: true,
                httpInfo: true,
                nseCategory: 'vuln',
                output: 'txt',
                notes: '×‘×“×™×§×ª ×—×“×™×¨×” ×œ×¨×©×ª ×”×¤× ×™××™×ª',
                startedAt: '2024-05-02T09:12:00Z',
                duration: '00:01:42',
                findings: [
                    { port: '22/tcp', status: 'open', service: 'ssh', detail: 'OpenSSH 8.2p1 Ubuntu 4ubuntu0.7' },
                    { port: '80/tcp', status: 'open', service: 'http', detail: 'Apache httpd 2.4.52' },
                    { port: '139/tcp', status: 'open', service: 'netbios-ssn', detail: 'Samba smbd 4.6.2' },
                    { port: '445/tcp', status: 'open', service: 'microsoft-ds', detail: 'Windows Server 2019' },
                ],
                logs: [
                    '[09:12:00] ×”×ª×—×œ×ª ×¡×¨×™×§×” ×¢××•×§×”',
                    '[09:12:08] ×–×™×”×•×™ ×©×™×¨×•×ª×™× ×¤×ª×•×—×™×...',
                    '[09:12:31] ×”×¨×¦×ª NSE vuln',
                    '[09:12:42] ×¡×™×•× ×“×•×— ×•×”×¤×§×” ×œ×”×•×¨×“×”',
                ],
            },
            {
                id: 'example-web',
                target: 'scanpro.demo',
                ports: '80, 443, 8080',
                profile: 'HTTP Info',
                serviceDetection: true,
                osDetection: false,
                httpInfo: true,
                nseCategory: 'default',
                output: 'json',
                notes: '×‘×“×™×§×ª ××ª×¨ ×—×™×¦×•× ×™ ×•-CORS',
                startedAt: '2024-05-06T14:30:00Z',
                duration: '00:00:28',
                findings: [
                    { port: '80/tcp', status: 'open', service: 'http', detail: 'nginx 1.23, TLS redirect enabled' },
                    { port: '443/tcp', status: 'open', service: 'https', detail: 'TLS 1.3, HSTS, ALPN http/2' },
                    { port: '8080/tcp', status: 'filtered', service: 'http-proxy', detail: 'Firewall drop, banner hidden' },
                ],
                logs: [
                    '[14:30:00] ×‘×“×™×§×ª HTTP/HTTPS',
                    '[14:30:12] TLS 1.3 + HSTS ×–×•×”×”',
                    '[14:30:21] ×‘×“×™×§×ª CORS ×•×”×¨×©××•×ª',
                    '[14:30:28] ×™×¦×™×¨×ª ×“×•×— JSON',
                ],
            },
        ];

        let activeReport = null;
        let statusFilter = 'all';
        let progressTimer = null;

        const templates = {
            fast: {
                target: '192.168.1.10',
                ports: '1-1000',
                profile: 'Quick',
                serviceDetection: true,
                osDetection: false,
                httpInfo: false,
                nseCategory: 'default',
                output: 'txt',
                notes: '×¡×¨×™×§×” ×–×¨×™×–×” ×©×œ ×¤×•×¨×˜×™× × ×¤×•×¦×™×',
            },
            web: {
                target: 'scanpro.demo',
                ports: '80,443,8080',
                profile: 'HTTP Info',
                serviceDetection: true,
                osDetection: false,
                httpInfo: true,
                nseCategory: 'safe',
                output: 'html',
                notes: '×‘×“×™×§×ª Web ×—×™×¦×•× ×™×ª ×¢× ××™×¡×•×£ ×›×•×ª×¨×•×ª ×•-TLS',
            },
            internal: {
                target: '10.10.10.5',
                ports: '1-1024, 3389, 5985',
                profile: 'Intense (Service + OS)',
                serviceDetection: true,
                osDetection: true,
                httpInfo: true,
                nseCategory: 'vuln',
                output: 'json',
                notes: '×ª×¡×¨×™×˜ ×¤× ×™××™ ×›×•×œ×œ NSE ×•-OS',
            },
        };

        const formatDate = (iso) => new Date(iso).toLocaleString();

        function applyTemplate(key) {
            const template = templates[key];
            if (!template) return;
            document.getElementById('target').value = template.target;
            document.getElementById('ports').value = template.ports;
            document.getElementById('profile').value = template.profile;
            document.getElementById('serviceDetection').checked = template.serviceDetection;
            document.getElementById('osDetection').checked = template.osDetection;
            document.getElementById('httpInfo').checked = template.httpInfo;
            document.getElementById('nseCategory').value = template.nseCategory;
            document.getElementById('output').value = template.output;
            document.getElementById('notes').value = template.notes;
        }

        function buildLogs(target) {
            const time = new Date();
            const pad = (n) => n.toString().padStart(2, '0');
            const stamp = `${pad(time.getHours())}:${pad(time.getMinutes())}:${pad(time.getSeconds())}`;
            return [
                `[${stamp}] ×”×•×¡×¤×ª ${target} ×œ×ª×•×¨ ×”×¡×¨×™×§×•×ª`,
                `[${stamp}] ×‘×“×™×§×ª ×¤×•×¨×˜×™× ×•×¤×¨×•×˜×•×§×•×œ×™×`,
                `[${stamp}] ××™×¡×•×£ ×‘×× ×¨×™× ×•×’×¨×¡××•×ª ×©×™×¨×•×ª`,
                `[${stamp}] ×”×¤×§×ª ×“×•×— ×œ×”×•×¨×“×” ×•×©×™×ª×•×£`,
            ];
        }

        function startProgress() {
            progressBlock.style.display = 'grid';
            progressBar.style.width = '6%';
            progressLabel.textContent = '×¡×¨×™×§×” ×”×ª×—×™×œ×”...';
            let width = 6;

            clearInterval(progressTimer);
            progressTimer = setInterval(() => {
                width = Math.min(100, width + Math.random() * 18);
                progressBar.style.width = `${width}%`;

                if (width > 80) {
                    progressLabel.textContent = '××¡×™×™× ×‘×“×™×§×•×ª NSE ×•-HTTP...';
                } else if (width > 40) {
                    progressLabel.textContent = '×–×™×”×•×™ ×©×™×¨×•×ª×™× ×•××¢×¨×›×•×ª...';
                } else {
                    progressLabel.textContent = '×¡×¨×™×§×” ×‘×¡×™×¡×™×ª ×¨×¦×”...';
                }

                if (width >= 100) {
                    clearInterval(progressTimer);
                    progressLabel.textContent = '×”×¡×¨×™×§×” ×”×¡×ª×™×™××”';
                    setTimeout(() => {
                        progressBlock.style.display = 'none';
                    }, 600);
                }
            }, 400);
        }

        function generateFindings(profile) {
            const base = [
                { port: '22/tcp', service: 'ssh', detail: 'OpenSSH 8.x' },
                { port: '53/udp', service: 'domain', detail: 'DNS recursion enabled' },
                { port: '80/tcp', service: 'http', detail: 'Apache 2.4' },
                { port: '443/tcp', service: 'https', detail: 'TLS 1.2/1.3, ALPN' },
                { port: '3306/tcp', service: 'mysql', detail: 'MariaDB 10.5' },
            ];

            return base.map((item, index) => {
                const statusPool = ['open', 'open', 'filtered', 'closed'];
                const profileBias = profile.includes('UDP') ? ['open', 'open', 'filtered', 'filtered'] : statusPool;
                const status = profileBias[(index + Math.floor(Math.random() * profileBias.length)) % profileBias.length];
                return { ...item, status };
            });
        }

        function renderReport(report) {
            activeReport = report;
            downloadButton.disabled = false;

            const summaryHtml = `
                <div class="summary">
                    <div class="summary-box">
                        <strong>××˜×¨×”</strong>
                        <span class="muted">${report.target}</span>
                    </div>
                    <div class="summary-box">
                        <strong>×¤×•×¨×˜</strong>
                        <span class="muted">${report.ports}</span>
                    </div>
                    <div class="summary-box">
                        <strong>×¤×¨×•×¤×™×œ</strong>
                        <span class="muted">${report.profile}</span>
                    </div>
                    <div class="summary-box">
                        <strong>××©×š</strong>
                        <span class="muted">${report.duration || 'â€”'}</span>
                    </div>
                </div>
            `;

            const chipsHtml = `
                <div class="chips">
                    <div class="chip">Service detection: ${report.serviceDetection ? 'on' : 'off'}</div>
                    <div class="chip">OS detection: ${report.osDetection ? 'on' : 'off'}</div>
                    <div class="chip">HTTP info: ${report.httpInfo ? 'on' : 'off'}</div>
                    <div class="chip">NSE: ${report.nseCategory}</div>
                    <div class="chip">Output: ${report.output?.toUpperCase?.() || 'TXT'}</div>
                </div>
            `;

            const filteredFindings = statusFilter === 'all'
                ? report.findings
                : report.findings.filter(item => item.status === statusFilter);

            const rows = filteredFindings.map(finding => `
                <tr>
                    <td>${finding.port}</td>
                    <td><span class="status ${finding.status}">${finding.status}</span></td>
                    <td>${finding.service}</td>
                    <td class="muted">${finding.detail}</td>
                </tr>
            `).join('');

            const notesBlock = report.notes ? `<p class="muted">×”×¢×¨×•×ª: ${report.notes}</p>` : '';

            const statusButtons = ['all', 'open', 'filtered', 'closed'].map(key => {
                const labels = { all: '×”×›×œ', open: '×¤×ª×•×—', filtered: '××¡×•× ×Ÿ', closed: '×¡×’×•×¨' };
                const active = statusFilter === key ? 'active' : '';
                return `<button type="button" class="${active}" data-filter="${key}">${labels[key]}</button>`;
            }).join('');

            const logs = (report.logs || []).length ? `<div class="logs">${report.logs.join('\n')}</div>` : '';

            reportViewer.innerHTML = `
                ${summaryHtml}
                ${chipsHtml}
                <div class="card" style="padding: 14px; background: rgba(255,255,255,0.02);">
                    <div class="report-header" style="margin-bottom: 6px;">
                        <h3 style="margin: 0;">×¤×•×¨×˜-×©×™×¨×•×ª</h3>
                        <span class="muted">${filteredFindings.length} ××ª×•×š ${report.findings.length} ×ª×•×¦××•×ª</span>
                    </div>
                    <div class="status-filters" id="statusFilters">${statusButtons}</div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Port</th>
                                <th>Status</th>
                                <th>Service</th>
                                <th>Details</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${rows}
                        </tbody>
                    </table>
                </div>
                ${notesBlock}
                ${logs}
            `;

            document.getElementById('statusFilters').addEventListener('click', (event) => {
                const button = event.target.closest('button[data-filter]');
                if (!button) return;
                statusFilter = button.getAttribute('data-filter');
                renderReport(report);
            });
        }

        function downloadActiveReport() {
            if (!activeReport) return;
            const format = activeReport.output || 'txt';
            let content = '';
            let mime = 'text/plain';
            let extension = format.toLowerCase();

            if (format === 'json') {
                content = JSON.stringify(activeReport, null, 2);
                mime = 'application/json';
            } else if (format === 'html') {
                content = `<!DOCTYPE html><html><body><pre>${JSON.stringify(activeReport, null, 2)}</pre></body></html>`;
                mime = 'text/html';
            } else {
                const rows = activeReport.findings.map(f => `${f.port}\t${f.status}\t${f.service}\t${f.detail}`).join('\n');
                content = `ScanPro report\nTarget: ${activeReport.target}\nProfile: ${activeReport.profile}\nPorts: ${activeReport.ports}\nNotes: ${activeReport.notes || ''}\n---\n${rows}`;
                extension = 'txt';
            }

            const blob = new Blob([content], { type: mime });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `scanpro-${activeReport.target.replace(/\W+/g, '-')}.${extension}`;
            link.click();
            URL.revokeObjectURL(url);
        }

        function renderHistory() {
            historyList.innerHTML = '';
            seedReports.slice().reverse().forEach(report => {
                const card = document.createElement('div');
                card.className = 'history-card';
                card.innerHTML = `
                    <div style="display:flex; justify-content: space-between; gap: 12px; flex-wrap: wrap;">
                        <div>
                            <strong>${report.target}</strong>
                            <div class="muted">${report.profile}</div>
                        </div>
                        <div class="history-actions">
                            <button class="btn secondary" data-id="${report.id}" data-action="view">ğŸ‘ï¸ ×¦×¤×™×™×”</button>
                            <button class="btn secondary" data-id="${report.id}" data-action="download">â¬‡ï¸ ×”×•×¨×“×”</button>
                        </div>
                    </div>
                    <div class="history-meta">
                        <span>×¤×•×¨×˜: ${report.ports}</span>
                        <span>Output: ${report.output.toUpperCase()}</span>
                        <span>Started: ${formatDate(report.startedAt)}</span>
                        <span>××©×š: ${report.duration}</span>
                    </div>
                `;
                historyList.appendChild(card);
            });
        }

        function handleHistoryClick(event) {
            const button = event.target.closest('button[data-id]');
            if (!button) return;
            const id = button.getAttribute('data-id');
            const action = button.getAttribute('data-action');
            const report = seedReports.find(r => r.id === id);
            if (!report) return;

            if (action === 'view') {
                renderReport(report);
            } else if (action === 'download') {
                renderReport(report);
                downloadActiveReport();
            }
        }

        function resetForm() {
            document.getElementById('scanForm').reset();
            document.getElementById('notes').value = '';
        }

        document.getElementById('scanForm').addEventListener('submit', (event) => {
            event.preventDefault();
            const target = document.getElementById('target').value.trim();
            const ports = document.getElementById('ports').value.trim();
            const profile = document.getElementById('profile').value;
            const serviceDetection = document.getElementById('serviceDetection').checked;
            const osDetection = document.getElementById('osDetection').checked;
            const httpInfo = document.getElementById('httpInfo').checked;
            const nseCategory = document.getElementById('nseCategory').value;
            const output = document.getElementById('output').value;
            const notes = document.getElementById('notes').value.trim();

            if (!target) return;

            startProgress();
            statusFilter = 'all';
            const findings = generateFindings(profile);
            const report = {
                id: `run-${Date.now()}`,
                target,
                ports,
                profile,
                serviceDetection,
                osDetection,
                httpInfo,
                nseCategory,
                output,
                notes,
                startedAt: new Date().toISOString(),
                duration: '00:00:15',
                findings,
                logs: buildLogs(target),
            };

            seedReports.push(report);
            renderReport(report);
            renderHistory();
        });

        downloadButton.addEventListener('click', downloadActiveReport);
        historyList.addEventListener('click', handleHistoryClick);
        document.getElementById('resetForm').addEventListener('click', resetForm);
        document.querySelectorAll('.action-chip').forEach(button => {
            button.addEventListener('click', () => applyTemplate(button.getAttribute('data-template')));
        });

        renderHistory();
        if (seedReports.length) {
            renderReport(seedReports[0]);
        }
    </script>
</body>

</html>
